<div class="card">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="card-title mb-0">User List</h4>
      <a href="/users/add" class="btn btn-primary btn-sm">+ Add User</a>
    </div>

    <div class="table-responsive">
      <table id="userTable" class="table table-bordered">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Email</th>
            <th>role_id</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<%
pageScripts = `
<script>
  const baseUrl = window.location.origin;

  async function deleteUser(id) {
    if (!confirm('Are you sure you want to delete this user?')) return;
    const response = await fetch("/users/delete/" + id, { method: "POST" });
    if (response.ok) {
      alert("User deleted successfully");
      window.location.reload();
    } else {
      alert("Error deleting user");
    }
  }

  document.addEventListener("DOMContentLoaded", async () => {
    const res = await fetch("/users/api/users");
    const users = await res.json();

    const tbody = document.querySelector("#userTable tbody");
    tbody.innerHTML = "";

    users.forEach((user, i) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${i + 1}</td>
        <td>${user.name}</td>
        <td>${user.email}</td>
        <td>${user.role_id || '-'}</td>
        <td>
          <a href="/users/edit/${user.id}" class="btn btn-info py-2">Edit</a>
          <button class="btn btn-danger py-2" onclick="deleteUser(${user.id})">Delete</button>
        </td>
      `;
      tbody.appendChild(row);
    });
  });
</script>
`;
%>

